<!DOCTYPE html>
<html>
<head>
<title>TARDIS - Dey Farm</title>
<meta charset="utf-8">
<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui" />
<style> @-ms-viewport { width: device-width; } </style>
<link rel="stylesheet" href="vendor/reset.min.css">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="tour-style.css">
</head>

<body class="multiple-scenes view-control-buttons">

<header>
  <nav>
    <ul>
      <li><a href="index.html">About</a></li>
      <li><a href="sites.html">Historic Sites</a></li>
      <li><a href="team.html">The Team</a></li>
      <li><a href="work-with-us.html">Work With Us</a></li>
      <li><a href="schools.html">For Schools</a></li>
    </ul>
  </nav>
</header>

<div id="pano"></div>

<div id="sceneList">
  <ul class="scenes">
      <a href="javascript:void(0)" class="scene" data-id="0-front_of_barn">
        <li class="text">Front of Barn</li>
      </a>
      <a href="javascript:void(0)" class="scene" data-id="1-barn_center">
        <li class="text">Barn Center</li>
      </a>
      <a href="javascript:void(0)" class="scene" data-id="2-barn_table">
        <li class="text">Barn Table</li>
      </a>
      <a href="javascript:void(0)" class="scene" data-id="3-wood_cutter">
        <li class="text">Wood Cutter</li>
      </a>
      <a href="javascript:void(0)" class="scene" data-id="4-back_of_barn">
        <li class="text">Back of Barn</li>
      </a>
      <a href="javascript:void(0)" class="scene" data-id="5-back_outside">
        <li class="text">Back Outside</li>
      </a>
      <a href="javascript:void(0)" class="scene" data-id="6-bed_otherside">
        <li class="text">Bedroom (Other Side)</li>
      </a>
      <a href="javascript:void(0)" class="scene" data-id="7-bedside">
        <li class="text">Bedroom (Bedside)</li>
      </a>
  </ul>
</div>

<div id="titleBar">
  <h1 class="sceneName"></h1>
</div>

<a href="javascript:void(0)" id="autorotateToggle">
  <img class="icon off" src="img/play.png">
  <img class="icon on" src="img/pause.png">
</a>

<a href="javascript:void(0)" id="fullscreenToggle">
  <img class="icon off" src="img/fullscreen.png">
  <img class="icon on" src="img/windowed.png">
</a>

<a href="javascript:void(0)" id="sceneListToggle">
  <img class="icon off" src="img/expand.png">
  <img class="icon on" src="img/collapse.png">
</a>

<a href="javascript:void(0)" id="viewUp" class="viewControlButton viewControlButton-1">
  <img class="icon" src="img/up.png">
</a>
<a href="javascript:void(0)" id="viewDown" class="viewControlButton viewControlButton-2">
  <img class="icon" src="img/down.png">
</a>
<a href="javascript:void(0)" id="viewLeft" class="viewControlButton viewControlButton-3">
  <img class="icon" src="img/left.png">
</a>
<a href="javascript:void(0)" id="viewRight" class="viewControlButton viewControlButton-4">
  <img class="icon" src="img/right.png">
</a>
<a href="javascript:void(0)" id="viewIn" class="viewControlButton viewControlButton-5">
  <img class="icon" src="img/plus.png">
</a>
<a href="javascript:void(0)" id="viewOut" class="viewControlButton viewControlButton-6">
  <img class="icon" src="img/minus.png">
</a>

<div id="infoModal" class="info-modal">
  <div class="info-modal-inner">
    <button id="infoModalClose" class="info-modal-close" aria-label="Close">Ã—</button>
    <h2 id="infoModalTitle"></h2>
    <div id="infoModalBody" class="info-modal-body"></div>
  </div>
</div>

<script src="vendor/screenfull.min.js" ></script>
<script src="vendor/bowser.min.js" ></script>
<script src="vendor/marzipano.js" ></script>

<script src="data.js"></script>
<script src="index.js"></script>


<div id="voice-box">
  <button id="voice-button">Speak</button>
</div>


<script>
  const API_URL = "https://tardis-backend.vercel.app/api/chat";

  const voiceButton = document.getElementById("voice-button");

  let recognition;

  if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = 'en-US';

    recognition.onresult = async (event) => {
      const transcript = event.results[0][0].transcript;
      console.log('User said:', transcript);

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            messages: [{ role: "user", content: transcript }],
          }),
        });
        const data = await res.json();
        const reply = data.reply?.content || "No response.";
        speak(reply);
      } catch (err) {
        console.error('Error:', err);
        speak("Error connecting to backend.");
      }
    };

    recognition.onerror = (event) => {
      console.error('Speech recognition error:', event.error);
      speak("Sorry, I didn't catch that.");
    };
  }

  function speak(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    window.speechSynthesis.speak(utterance);
  }

  voiceButton.addEventListener("click", () => {
    if (recognition) {
      recognition.start();
      voiceButton.textContent = "Listening...";
      recognition.onend = () => {
        voiceButton.textContent = "Speak";
      };
    } else {
      speak("Speech recognition not supported in this browser.");
    }
  });
</script>



</body>
</html>